- hosts: all
  become: yes
  tasks:
    - name: Set authorized keys taken from keys folder
      ansible.posix.authorized_key:
        user: vagrant
        state: present
        key: "{{ lookup('file', item) }}"
      with_fileglob:
        - "/vagrant/host_keys/*.pub"
    - name: Disable SWAP
      ansible.builtin.shell: swapoff -a
    - name: Disable SWAP in fstab
      ansible.builtin.lineinfile:
        path: /etc/fstab
        regexp: '^/swap.*'
        state: absent
    - name: Automate module load at boot
      ansible.builtin.copy: 
        dest: /etc/modules-load.d/k8s.conf
        content: |
          br_netfilter
          overlay
    - name: Load modules
      community.general.modprobe:
        name: "{{ item }}"
      loop:
        - br_netfilter
        - overlay